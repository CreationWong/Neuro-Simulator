<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>𝐯𝐞𝐝𝐚𝐥𝟗𝟖𝟕 𝐒𝐢𝐦𝐮𝐥𝐚𝐭𝐨𝐫</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="icon" href="assets/favicon.ico" type="image/x-icon">
</head>
<body>
    <!-- 横幅提示容器 -->
    <div id="toastContainer" class="toast-container"></div>
    
    <!-- 确认对话框容器 -->
    <div id="confirmDialog" class="confirm-dialog">
        <div class="confirm-content">
            <div class="confirm-message"></div>
            <div class="confirm-buttons">
                <button class="btn secondary confirm-cancel">取消</button>
                <button class="btn primary confirm-ok">确定</button>
            </div>
        </div>
    </div>
    
    <!-- 添加记忆块对话框 -->
    <div id="addMemoryBlockDialog" class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h3>添加记忆块</h3>
                <button class="close-btn">&times;</button>
            </div>
            <div class="modal-body">
                <form id="addMemoryBlockForm">
                    <div class="form-group">
                        <label for="memoryTitle">标题:</label>
                        <input type="text" id="memoryTitle" required class="form-control">
                    </div>
                    <div class="form-group">
                        <label for="memoryDescription">描述:</label>
                        <textarea id="memoryDescription" rows="2" class="form-control"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="memoryContent">内容 (每行一条):</label>
                        <textarea id="memoryContent" rows="4" class="form-control"></textarea>
                    </div>
                    <div class="button-group">
                        <button type="button" class="btn secondary" id="cancelAddMemoryBtn">取消</button>
                        <button type="submit" class="btn primary">添加</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    
    <div class="container">
        <header>
            <h1>vedal987 🐢 Simulator</h1>
            <div class="connection-status" id="connectionStatus">
                <span class="status-dot disconnected"></span>
                <span class="status-text">未连接</span>
            </div>
        </header>

        <main class="main-layout">
            <!-- 侧边导航栏 -->
            <nav class="sidebar" id="sidebar">
                <ul class="nav-tabs">
                    <li class="nav-tab active" data-tab="connection">
                        <span>连接</span>
                    </li>
                    <li class="nav-tab" data-tab="control">
                        <span>控制</span>
                    </li>
                    <li class="nav-tab" data-tab="config">
                        <span>配置</span>
                    </li>
                    <li class="nav-tab" data-tab="logs">
                        <span>日志</span>
                    </li>
                    <li class="nav-tab" id="agentManagementTab" style="display: none;" data-tab="agent-management">
                        <span>Agent管理</span>
                    </li>
                    <li class="nav-tab" id="chatbotManagementTab" style="display: none;" data-tab="chatbot-management">
                        <span>ChatBot管理</span>
                    </li>
                </ul>
            </nav>

            <!-- 内容区域 -->
            <div class="content-area">
                <!-- 连接设置区域 -->
                <section class="tab-content active" id="connection-tab">
                    <div class="card">
                        <h2>连接设置</h2>
                        <form id="connectionForm">
                            <div class="form-group">
                                <label for="backendUrl">后端地址:</label>
                                <input type="url" id="backendUrl" placeholder="http://localhost:8000" required class="form-control">
                            </div>
                            <div class="form-group">
                                <label for="password">访问密码 (可选):</label>
                                <input type="password" id="password" placeholder="留空表示无密码" class="form-control">
                            </div>
                            <div class="form-actions">
                                <button type="submit" class="btn primary">连接</button>
                                <button type="button" id="disconnectBtn" class="btn secondary" disabled>断开连接</button>
                            </div>
                        </form>
                    </div>
                </section>

                <!-- 控制标签页 -->
                <section id="control-tab" class="tab-content">
                    <div class="card">
                        <h2>直播控制</h2>
                        <div class="stream-status">
                            <p>当前状态: <span id="streamStatus">未知</span></p>
                        </div>
                        <div class="control-buttons">
                            <button id="startStreamBtn" class="btn primary">开始直播</button>
                            <button id="stopStreamBtn" class="btn danger">停止直播</button>
                            <button id="restartStreamBtn" class="btn warning">重启直播</button>
                        </div>
                    </div>
                </section>

                <!-- 配置管理区域 -->
                <section class="tab-content" id="config-tab">
                    <div class="card">
                        <h2>配置管理</h2>
                        <div class="config-info">
                            <p>注意：API密钥、主播昵称、TTS设置和服务器设置不会在此面板中显示或修改。</p>
                        </div>
                        <form id="configForm">
                            <!-- Stream Metadata Section (除了streamer_nickname) -->
                            <div class="config-section">
                                <h3>直播元数据</h3>
                                <div class="form-group">
                                    <label for="stream_title">直播标题:</label>
                                    <input type="text" id="stream_title" name="stream_metadata.stream_title" class="form-control">
                                </div>
                                <div class="form-group">
                                    <label for="stream_category">直播分类:</label>
                                    <input type="text" id="stream_category" name="stream_metadata.stream_category" class="form-control">
                                </div>
                                <div class="form-group">
                                    <label for="stream_tags">直播标签 (逗号分隔):</label>
                                    <input type="text" id="stream_tags" name="stream_metadata.stream_tags" class="form-control">
                                </div>
                            </div>

                            <!-- Neuro Behavior Section -->
                            <div class="config-section">
                                <h3>Neuro行为设置</h3>
                                <div class="form-group">
                                    <label for="input_chat_sample_size">输入聊天样本数量:</label>
                                    <input type="number" id="input_chat_sample_size" name="neuro_behavior.input_chat_sample_size" class="form-control" min="1">
                                </div>
                                <div class="form-group">
                                    <label for="post_speech_cooldown_sec">说话后冷却时间 (秒):</label>
                                    <input type="number" id="post_speech_cooldown_sec" name="neuro_behavior.post_speech_cooldown_sec" class="form-control" step="0.1" min="0">
                                </div>
                                <div class="form-group">
                                    <label for="initial_greeting">初始问候语:</label>
                                    <textarea id="initial_greeting" name="neuro_behavior.initial_greeting" class="form-control" rows="3"></textarea>
                                </div>
                            </div>

                            <!-- Agent Configuration Section -->
                            <div class="config-section">
                                <h3>Agent设置（仅当使用内建Agent时有效）</h3>
                                <div class="form-group">
                                    <label for="agent_provider">LLM提供商:</label>
                                    <select id="agent_provider" name="agent.agent_provider" class="form-control">
                                        <option value="gemini">Gemini</option>
                                        <option value="openai">OpenAI</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="agent_model">模型:</label>
                                    <input type="text" id="agent_model" name="agent.agent_model" class="form-control">
                                </div>
                            </div>

                            <!-- Audience Simulation Section -->
                            <div class="config-section">
                                <h3>观众模拟设置</h3>
                                <div class="form-group">
                                    <label for="llm_provider">LLM提供商:</label>
                                    <select id="llm_provider" name="audience_simulation.llm_provider" class="form-control">
                                        <option value="gemini">Gemini</option>
                                        <option value="openai">OpenAI</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="gemini_model">Gemini模型:</label>
                                    <input type="text" id="gemini_model" name="audience_simulation.gemini_model" class="form-control">
                                </div>
                                <div class="form-group">
                                    <label for="openai_model">OpenAI模型:</label>
                                    <input type="text" id="openai_model" name="audience_simulation.openai_model" class="form-control">
                                </div>
                                <div class="form-group">
                                    <label for="llm_temperature">LLM温度:</label>
                                    <input type="number" id="llm_temperature" name="audience_simulation.llm_temperature" class="form-control" step="0.1" min="0" max="2">
                                </div>
                                <div class="form-group">
                                    <label for="chat_generation_interval_sec">聊天生成间隔 (秒):</label>
                                    <input type="number" id="chat_generation_interval_sec" name="audience_simulation.chat_generation_interval_sec" class="form-control" min="1">
                                </div>
                                <div class="form-group">
                                    <label for="chats_per_batch">每批聊天数量:</label>
                                    <input type="number" id="chats_per_batch" name="audience_simulation.chats_per_batch" class="form-control" min="1">
                                </div>
                                <div class="form-group">
                                    <label for="max_output_tokens">最大输出Token数:</label>
                                    <input type="number" id="max_output_tokens" name="audience_simulation.max_output_tokens" class="form-control" min="1">
                                </div>
                                <div class="form-group">
                                    <label for="username_blocklist">用户名黑名单 (逗号分隔):</label>
                                    <input type="text" id="username_blocklist" name="audience_simulation.username_blocklist" class="form-control">
                                </div>
                                <div class="form-group">
                                    <label for="username_pool">用户名池 (逗号分隔):</label>
                                    <input type="text" id="username_pool" name="audience_simulation.username_pool" class="form-control">
                                </div>
                            </div>

                            <!-- Performance Section -->
                            <div class="config-section">
                                <h3>性能设置</h3>
                                <div class="form-group">
                                    <label for="neuro_input_queue_max_size">Neuro输入队列最大大小:</label>
                                    <input type="number" id="neuro_input_queue_max_size" name="performance.neuro_input_queue_max_size" class="form-control" min="1">
                                </div>
                                <div class="form-group">
                                    <label for="audience_chat_buffer_max_size">观众聊天缓冲区最大大小:</label>
                                    <input type="number" id="audience_chat_buffer_max_size" name="performance.audience_chat_buffer_max_size" class="form-control" min="1">
                                </div>
                                <div class="form-group">
                                    <label for="initial_chat_backlog_limit">初始聊天积压限制:</label>
                                    <input type="number" id="initial_chat_backlog_limit" name="performance.initial_chat_backlog_limit" class="form-control" min="1">
                                </div>
                            </div>

                            <div class="form-actions">
                                <button type="button" id="resetConfigBtn" class="btn secondary">重置</button>
                                <button type="submit" id="saveConfigBtn" class="btn primary">保存配置</button>
                            </div>
                        </form>
                        <div class="config-warning">
                            <p>警告：如果配置文件被修改或添加了新条目，此面板可能不会显示所有设置。请检查后端日志以获取更多信息。</p>
                        </div>
                    </div>
                </section>

                <!-- 日志标签页 -->
                <section id="logs-tab" class="tab-content">
                    <div class="card">
                        <h2>Server日志</h2>
                        <div id="serverLogsOutput" class="messages-output"></div>
                    </div>
                </section>

                <!-- Agent管理标签页 -->
                <section id="agent-management-tab" class="tab-content">
                    <div class="card">
                        <div class="agent-tabs">
                            <button class="agent-tab-btn active" data-agent-tab="context">对话上下文</button>
                            <button class="agent-tab-btn" data-agent-tab="memory">记忆</button>
                            <button class="agent-tab-btn" data-agent-tab="tools">工具</button>
                            <button class="agent-tab-btn" data-agent-tab="agent-logs">Agent日志</button>
                        </div>
                        
                        <!-- 对话上下文 Tab -->
                        <div class="agent-tab-content active" id="context-agent-tab">
                            <div class="agent-controls">
                                <label class="switch">
                                    <input type="checkbox" id="contextViewMode">
                                    <span class="slider"></span>
                                </label>
                                <span>切换显示模式：<span id="modeLabel">对话模式</span></span>
                            </div>
                            <div id="contextOutput" class="memory-output"></div>
                        </div>
                        
                        <!-- 记忆 Tab -->
                        <div class="agent-tab-content" id="memory-agent-tab">
                            <div class="memory-section">
                                <h3>临时记忆 (Temp Memory)</h3>
                                <div class="agent-controls">
                                    <button id="refreshTempMemoryBtn" class="btn secondary">刷新</button>
                                    <button id="clearTempMemoryBtn" class="btn danger">清空</button>
                                </div>
                                <div id="tempMemoryOutput" class="memory-output"></div>
                            </div>
                            
                            <div class="memory-section">
                                <h3>核心记忆 (Core Memory)</h3>
                                <div class="agent-controls">
                                    <button id="refreshCoreMemoryBtn" class="btn secondary">刷新</button>
                                    <button id="addCoreMemoryBlockBtn" class="btn primary">添加记忆块</button>
                                </div>
                                <div id="coreMemoryOutput" class="memory-output"></div>
                            </div>
                        </div>
                        
                        <!-- 工具 Tab -->
                        <div class="agent-tab-content" id="tools-agent-tab">
                            <div class="agent-controls">
                                <button id="refreshToolsBtn" class="btn secondary">刷新工具</button>
                            </div>
                            <div id="toolsOutput" class="tools-output"></div>
                            
                            <div class="tool-connection">
                                <h3>工具连接</h3>
                                <div class="form-group">
                                    <label for="toolName">工具名称:</label>
                                    <input type="text" id="toolName" class="form-control" placeholder="输入工具名称">
                                </div>
                                <div class="form-group">
                                    <label for="aiToolName">连接到AI的工具:</label>
                                    <input type="text" id="aiToolName" class="form-control" placeholder="输入AI工具名称">
                                </div>
                                <button id="connectToolBtn" class="btn primary">连接工具</button>
                            </div>
                        </div>
                        
                        <!-- Agent日志 Tab -->
                        <div class="agent-tab-content" id="agent-logs-agent-tab">
                            <div id="agentLogsOutput" class="messages-output"></div>
                        </div>
                    </div>
                </section>

                <!-- ChatBot管理标签页 -->
                <section id="chatbot-management-tab" class="tab-content">
                    <div class="card">
                        <h2>ChatBot管理</h2>
                        <p>此功能尚未实现。</p>
                    </div>
                </section>

                
            </div>
        </main>

        <footer>
            <p>*Evil sold out</p>
        </footer>
    </div>

    <script src="js/modules/connection.js"></script>
    <script src="js/modules/ui.js"></script>
    <script src="js/modules/stream.js"></script>
    <script src="js/modules/config.js"></script>
    <script src="js/modules/agent.js"></script>
    <script src="js/modules/chatbot.js"></script>
    <script src="js/main.js"></script>
</body>
</html>