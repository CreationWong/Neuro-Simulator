<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>𝐯𝐞𝐝𝐚𝐥𝟗𝟖𝟕 𝐒𝐢𝐦𝐮𝐥𝐚𝐭𝐨𝐫</title>
    <link rel="icon" href="assets/favicon.ico" type="image/x-icon">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="css/style.css">
    <script src="https://cdn.jsdelivr.net/npm/@json-editor/json-editor@2.10.0/dist/jsoneditor.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</head>
<body>
    <!-- 横幅提示容器 -->
    <div id="toastContainer" class="toast-container"></div>
    
    <!-- 确认对话框容器 -->
    <div id="confirmDialog" class="confirm-dialog">
        <div class="confirm-content">
            <div class="confirm-message"></div>
            <div class="confirm-buttons">
                <button class="btn secondary confirm-cancel">取消</button>
                <button class="btn primary confirm-ok">确定</button>
            </div>
        </div>
    </div>
    
    <!-- 添加记忆块对话框 -->
    <div id="addMemoryBlockDialog" class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h3>添加记忆块</h3>
                <button class="close-btn">&times;</button>
            </div>
            <div class="modal-body">
                <form id="addMemoryBlockForm">
                    <div class="form-group">
                        <label for="memoryTitle">标题:</label>
                        <input type="text" id="memoryTitle" required class="form-control">
                    </div>
                    <div class="form-group">
                        <label for="memoryDescription">描述:</label>
                        <textarea id="memoryDescription" rows="2" class="form-control"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="memoryContent">内容 (每行一条):</label>
                        <textarea id="memoryContent" rows="4" class="form-control"></textarea>
                    </div>
                    <div class="button-group">
                        <button type="button" class="btn secondary" id="cancelAddMemoryBtn">取消</button>
                        <button type="submit" class="btn primary">添加</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    
    <div class="container">
        <header>
            <h1>vedal987 🐢 Simulator</h1>
            <div class="connection-status" id="connectionStatus">
                <span class="status-dot disconnected"></span>
                <span class="status-text">未连接</span>
            </div>
        </header>

        <main class="main-layout">
            <!-- 侧边导航栏 -->
            <nav class="sidebar" id="sidebar">
                <ul class="nav-tabs">
                    <li class="nav-tab active" data-tab="connection">
                        <span>连接</span>
                    </li>
                    <li class="nav-tab" data-tab="control">
                        <span>控制</span>
                    </li>
                    <li class="nav-tab" data-tab="config">
                        <span>配置</span>
                    </li>
                    <li class="nav-tab" data-tab="logs">
                        <span>日志</span>
                    </li>
                    <li class="nav-tab" id="agentManagementTab" data-tab="agent-management">
                        <span>Agent</span>
                    </li>
                    <li class="nav-tab" id="chatbotManagementTab" data-tab="chatbot-management">
                        <span>ChatBot</span>
                    </li>
                </ul>
            </nav>

            <!-- 内容区域 -->
            <div class="content-area">
                <!-- 连接设置区域 -->
                <section class="main-tab-content active" id="connection-tab">
                    <div class="card">
                        <h2>连接设置</h2>
                        <form id="connectionForm">
                            <div class="form-group">
                                <label for="backendUrl">后端地址:</label>
                                <input type="url" id="backendUrl" placeholder="http://localhost:8000" required class="form-control">
                            </div>
                            <div class="form-group">
                                <label for="password">访问密码 (可选):</label>
                                <input type="password" id="password" placeholder="留空表示无密码" class="form-control">
                            </div>
                            <div class="form-actions">
                                <button type="submit" class="btn primary">连接</button>
                                <button type="button" id="disconnectBtn" class="btn secondary" disabled>断开连接</button>
                            </div>
                        </form>
                    </div>
                </section>

                <!-- 控制标签页 -->
                <section id="control-tab" class="main-tab-content">
                    <div class="card">
                        <h2>直播控制</h2>
                        <div class="stream-status">
                            <p>当前状态: <span id="streamStatus">未知</span></p>
                        </div>
                        <div class="control-buttons">
                            <button id="startStreamBtn" class="btn primary">开始直播</button>
                            <button id="stopStreamBtn" class="btn danger">停止直播</button>
                            <button id="restartStreamBtn" class="btn warning">重启直播</button>
                        </div>
                    </div>
                </section>

                <!-- 配置管理区域 -->
                <section class="main-tab-content" id="config-tab">
                    <div class="card">
                        <h2>配置管理</h2>
                        <div id="config-editor-container"></div>
                        <div class="form-actions" style="margin-top: 20px;">
                            <button type="button" id="saveConfigBtn" class="btn primary">保存配置</button>
                        </div>
                    </div>
                </section>

                <!-- 日志标签页 -->
                <section id="logs-tab" class="main-tab-content">
                    <div class="card">
                        <h2>Server日志</h2>
                        <div id="serverLogsOutput" class="messages-output"></div>
                    </div>
                </section>

                <!-- Agent管理标签页 -->
                <section id="agent-management-tab" class="main-tab-content">
                    <div class="card">
                        <ul class="nav nav-tabs" id="agent-nav-tabs" role="tablist">
                            <li class="nav-item" role="presentation">
                                <button class="nav-link active" id="context-tab-btn" data-bs-toggle="tab" data-bs-target="#context-agent-tab" type="button" role="tab" aria-controls="context-agent-tab" aria-selected="true">对话</button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="memory-tab-btn" data-bs-toggle="tab" data-bs-target="#memory-agent-tab" type="button" role="tab" aria-controls="memory-agent-tab" aria-selected="false">记忆</button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="tools-tab-btn" data-bs-toggle="tab" data-bs-target="#tools-agent-tab" type="button" role="tab" aria-controls="tools-agent-tab" aria-selected="false">工具</button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="agent-logs-tab-btn" data-bs-toggle="tab" data-bs-target="#agent-logs-agent-tab" type="button" role="tab" aria-controls="agent-logs-agent-tab" aria-selected="false">日志</button>
                            </li>
                        </ul>
                        
                        <div class="tab-content" id="agent-tab-content">
                            <!-- 对话 Tab -->
                            <div class="tab-pane fade show active" id="context-agent-tab" role="tabpanel" aria-labelledby="context-tab-btn">
                                <div class="agent-controls">
                                    <label class="switch">
                                        <input type="checkbox" id="contextViewMode">
                                        <span class="slider"></span>
                                    </label>
                                    <span>切换显示模式：<span id="modeLabel">对话模式</span></span>
                                </div>
                                <div id="contextOutput" class="memory-output"></div>
                            </div>
                            
                            <!-- 记忆 Tab -->
                            <div class="tab-pane fade" id="memory-agent-tab" role="tabpanel" aria-labelledby="memory-tab-btn">
                                <div class="memory-section">
                                    <h3>初始化记忆 (Init Memory)</h3>
                                    <div class="agent-controls">
                                        <button id="refreshInitMemoryBtn" class="btn secondary">刷新</button>
                                        <button id="addInitMemoryItemBtn" class="btn primary">添加</button>
                                    </div>
                                    <div id="initMemoryOutput" class="memory-output"></div>
                                </div>
                                
                                <div class="memory-section">
                                    <h3>临时记忆 (Temp Memory)</h3>
                                    <div class="agent-controls">
                                        <button id="refreshTempMemoryBtn" class="btn secondary">刷新</button>
                                        <button id="addTempMemoryBtn" class="btn primary">添加</button>
                                        <button id="clearTempMemoryBtn" class="btn danger">清空</button>
                                    </div>
                                    <div id="tempMemoryOutput" class="memory-output"></div>
                                </div>
                                
                                <div class="memory-section">
                                    <h3>核心记忆 (Core Memory)</h3>
                                    <div class="agent-controls">
                                        <button id="refreshCoreMemoryBtn" class="btn secondary">刷新</button>
                                        <button id="addCoreMemoryBlockBtn" class="btn primary">添加记忆块</button>
                                    </div>
                                    <div id="coreMemoryOutput" class="memory-output"></div>
                                </div>
                            </div>
                            
                            <!-- 工具 Tab -->
                            <div class="tab-pane fade" id="tools-agent-tab" role="tabpanel" aria-labelledby="tools-tab-btn">
                                <div class="card">
                                    <h3>可用工具管理</h3>
                                    <p class="description">在这里为 Agent 分配可用的工具标签。Neuro Agent 负责与观众互动，Memory Agent 负责在后台整理记忆。</p>
                                    <div class="agent-controls">
                                        <button id="reloadToolsBtn" class="btn secondary">重载工具</button>
                                        <button id="saveToolAllocationsBtn" class="btn primary">保存分配</button>
                                    </div>
                                    <div id="allToolsContainer" class="tools-management-container">
                                        <!-- All available tools will be rendered here by JavaScript -->
                                        <p>正在加载工具...</p>
                                    </div>
                                </div>
                            
                                <div class="card-container-horizontal">
                                    <div class="card">
                                        <h3>Neuro Agent 工具集</h3>
                                        <div id="neuroAgentTools" class="tools-display-container">
                                            <!-- Neuro Agent's tools will be rendered here -->
                                        </div>
                                    </div>
                                    <div class="card">
                                        <h3>Memory Agent 工具集</h3>
                                        <div id="memoryAgentTools" class="tools-display-container">
                                            <!-- Memory Agent's tools will be rendered here -->
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- 日志 Tab -->
                            <div class="tab-pane fade" id="agent-logs-agent-tab" role="tabpanel" aria-labelledby="agent-logs-tab-btn">
                                <div id="agentLogsOutput" class="messages-output"></div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- ChatBot管理标签页 -->
                <section id="chatbot-management-tab" class="main-tab-content">
                    <div class="card">
                        <h2>ChatBot管理</h2>
                        <p>此功能尚未实现。</p>
                    </div>
                </section>

                
            </div>
        </main>

        <footer>
            <p>*Evil sold out</p>
        </footer>
    </div>

    <script src="js/modules/connection.js"></script>
    <script src="js/modules/ui.js"></script>
    <script src="js/modules/stream.js"></script>
    <script src="js/modules/config.js"></script>
    <script src="js/modules/agent.js"></script>
    <script src="js/modules/tools.js"></script>
    <script src="js/main.js"></script>
</body>
</html>